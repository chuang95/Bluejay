p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1),na.rm = TRUE,colour="grey50" size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1),na.rm = TRUE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1),na.rm = TRUE,colour="grey50" size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1),na.rm = TRUE,colour="red" size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1),na.rm = TRUE,colour="grey50", size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = 1),na.rm = TRUE,colour="grey50", size = 3)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1),na.rm = TRUE,colour="grey50", size = 3)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(fill=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=9#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy_n =Therapy[which(Therapy!="NULL")]#
Therapy_n =Therapy_n[which(Therapy_n!="continue")]#
#
l=length(Therapy_n)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy_n[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy_n)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy_n)#
Therapy_s= Therapy_n#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy_n[t],1,2)#
}
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
Pinf
Pinf[,3]
Pinf[,2]
Pinf[,2]>500
which(Pinf[,2]>500)
solid_in=which(Pinf[,2]<=500)
solid+in
solid_in
Pinf[which(Pinf[,2]>500),3]=500
Pinf
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=9#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy_n =Therapy[which(Therapy!="NULL")]#
Therapy_n =Therapy_n[which(Therapy_n!="continue")]#
#
l=length(Therapy_n)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy_n[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy_n)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy_n)#
Therapy_s= Therapy_n#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy_n[t],1,2)#
}
Pinf[which(Pinf[,2]>500),2]=500
Pinf
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=9#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy_n =Therapy[which(Therapy!="NULL")]#
Therapy_n =Therapy_n[which(Therapy_n!="continue")]#
#
l=length(Therapy_n)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy_n[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy_n)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy_n)#
Therapy_s= Therapy_n#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy_n[t],1,2)#
}
solid_in=which(Pinf[,2]<=500)
Pinf[which(Pinf[,2]>500),2]=500
solid_p=Pinf[which(Pinf[,2]<500),]
solid_p
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days[], y=ca125, group=1,na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1,na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1,na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
solid_p
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1,na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)
p
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)
p+geom_point(data= solid_p, aes(x=days, y=ca125, group=1,na.rm = TRUE,size = 3)
)
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=9#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy_n =Therapy[which(Therapy!="NULL")]#
Therapy_n =Therapy_n[which(Therapy_n!="continue")]#
#
l=length(Therapy_n)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy_n[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy_n)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy_n)#
Therapy_s= Therapy_n#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy_n[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy_n), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=9#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=9#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=1#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=2#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
fn
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=3#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=4#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)
fn
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=5#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=6#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=7#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=8#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=9#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=10#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=11#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=12#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=13#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=14#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=15#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=16#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=17#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=18#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=19#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=20#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=21#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
xstart
xend
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=21#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]
p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())
p
rects
Pinf
solid_p
length(solid_p)
dim(solid_p)
dim(solid_p)[1]
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=21#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0)#
{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
else#
{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=21#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=21#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=1#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
fn
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=18#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())+theme(plot.title = element_text(lineheight=.8, face="bold"))#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())+theme(plot.title = element_text(lineheight=1, face="bold"))#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())+theme(plot.title = element_text(lineheight=10, face="bold"))#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())+theme(plot.title = element_text(plot.title = element_text(size = rel(2)), face="bold"))#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=.8, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)+theme(plot.title = element_text(plot.title = element_text(size = rel(2)), face="bold"))
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=1, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(lineheight=10, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(plot.title = element_text(size = rel(2)), face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(plot.title = element_text(size=22), face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(size=22, face="bold")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(size=22, face="bold",fontface="italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(size=22, fontface="italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(size=15, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=18#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(size=15, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)
fn
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=15#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=15#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA-125", sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=18#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," ca125", sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=18#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA-125", sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=18#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$CA-125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA-125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA-125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=CA-125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA-125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA-125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA-125", sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
Pinf
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=18#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$CA125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=CA125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 250)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
fn
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=15#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$CA125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=CA125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)
fn
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=21#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$CA125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=CA125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
Pinf
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=21#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)
Pinf
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)
Pinf
Pinf=Pinf[!is.na(Pinf$CA125),]
Pinf
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=21#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)
Pinf
Pinf$CA125
Pinf=Pinf[!is.na(Pinf$ca125),]
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=21#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=CA125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=21#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$CA125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=CA125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=21#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$CA125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=CA125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 300+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=21#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$CA125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=CA125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 300)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=21#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)#
xend=as.numeric(xend)#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$CA125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
}#
#solid_in=which(Pinf[,2]<=500)#
Pinf[which(Pinf[,2]>500),2]=500#
solid_p=Pinf[which(Pinf[,2]<500),]#
#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=CA125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=CA125, group=1)) + geom_point(data= Pinf, aes(x=days, y=CA125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, 200)+ylim(0,500)#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
fn=list.files(".","*.pd")#
lfn=length(fn)
fn
f=1#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
pd = dim(Pinf)#
#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])
s_d
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=7#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)#+ylim(CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)#+ylim(CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=7#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=7#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=1#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
f=2
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=2#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=3#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=4#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=6#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=7#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=8#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=9#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=10#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=11#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=12#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=13#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=14#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=16#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=17#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=18#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=19#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=20#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=21#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=21#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=1#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
Pinf=Pinf[which(Pinf[,1]<(s_d[1]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))
#############
#ggplot#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=1
#############
#ggplot#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=1#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
s_l = length(s_d)#
Pinf=Pinf[which(Pinf[,1]<(s_d[s_l]+ Day_limit)),]
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)
Pinf
#############
#ggplot#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=1#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
s_l = length(s_d)#
Pinf=Pinf[which(Pinf[,1]<(s_d[s_l]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=2#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
s_l = length(s_d)#
Pinf=Pinf[which(Pinf[,1]<(s_d[s_l]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=3#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
s_l = length(s_d)#
Pinf=Pinf[which(Pinf[,1]<(s_d[s_l]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=4#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
s_l = length(s_d)#
Pinf=Pinf[which(Pinf[,1]<(s_d[s_l]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
#############
#ggplot#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=5#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
s_l = length(s_d)#
Pinf=Pinf[which(Pinf[,1]<(s_d[s_l]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
	{#
		label="CA125 decrease caused by surgery"#
	}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
	{#
		label="sensitive"#
	}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
	{#
		label="resistant"#
	}else#
	{#
		label="non-determined"#
	}#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
Pinf[1,2]
Pinf
fn[f]
#############
#ggplot#
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
#
mav <- function(x,n=5){filter(x,rep(1/n,n), sides=2)}#
#
Day_limit=200#
CA125_limit=500#
CA125_bound=35#
#
fn=list.files(".","*.pd")#
lfn=length(fn)#
#for(f in 1:lfn){#
f=5#
fname=strsplit(fn[f], split='.', fixed=TRUE)#
pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
#print(pname)#
#
Pinf =read.csv(fn[f],head=TRUE)#
#
s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
s_l = length(s_d)#
Pinf=Pinf[which(Pinf[,1]<(s_d[s_l]+ Day_limit)),]#
n_nullind=which(Pinf$drug!= "NULL")#
nnl=length(n_nullind)#
last_day=Pinf$days[n_nullind[nnl]]#
last_d=Pinf$drug[n_nullind[nnl]]#
#
pd = dim(Pinf)#
#
#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
Therapy =Therapy[which(Therapy!="continue")]#
#
l=length(Therapy)#
din=list()#
for (i in 1:l)#
{#
    temp=which(Pinf$drug== Therapy[i])#
    din=cbind(din,t(Pinf$days[temp]))#
}#
#
din=as.numeric(din)#
#
din=sort(unique(din))#
#
if(din[l]!=last_day)#
{#
    din=c(din,last_day)#
    l=l+1#
}#
#
if(din[l]==last_day && last_d!="continue")#
{#
    din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
    l=l+1#
}#
#
nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
ndl=length(nd)#
#
k=1#
xstart=list()#
xend=list()#
kflag=FALSE#
for (j in 1:(l-1))#
{#
    while(din[j]>nd[k] && !kflag)#
    {#
        k=k+1#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
            break#
        }#
    }#
    if(din[j]<nd[k] && !kflag && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        if(din[j+1]<nd[k])#
        {#
            xend=c(xend,din[j+1]-1)#
        }#
        else#
        {#
            xend=c(xend,nd[k])#
            k=k+1#
        }#
    }#
    else if(kflag && din[j]>nd[k] && j<(l-1))#
    {#
        xstart=c(xstart,din[j])#
        xend=c(xend,din[j+1]-1)#
    }#
    else if(j==(l-1))#
    {#
        xstart=c(xstart,din[j])#
    }#
    else#
    {#
        xstart=c(xstart,din[j])#
        k=k+1#
    }#
    if(k>ndl)#
    {#
        k=ndl#
        kflag=TRUE#
    }#
}#
xend=c(xend,din[j+1])#
#
xstart=as.numeric(xstart)-(s_d[1]+21)#
xend=as.numeric(xend)-(s_d[1]+21)#
xstart[which(xstart<0)]=0#
xend[which(xend<0)]=0#
#
rects <- data.frame(xstart, xend, Therapy)#
#
Pinf=Pinf[!is.na(Pinf$ca125),]#
y_l=max(Pinf[,2]+300)#
l_t=length(Therapy)#
Therapy_s= Therapy#
Therapy_carb_taxol=NA#
tct=1#
for(t in 1:l_t)#
{#
	Therapy_s[t]=substr(Therapy[t],1,2)#
	if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
	{#
		Therapy_carb_taxol[tct]=t#
		tct=tct+1#
	}#
}#
Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
Pinf=Pinf[which(Pinf[,1]>0),]#
#
solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
#solid_in=which(Pinf[,2]<= CA125_limit)#
solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
Pinf[which(Pinf[,2]>500),2]= CA125_limit#
#solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
s_n=length(solid_p_x[,2])#
#average_drop_rate=mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
adr=mean(diff(mav(solid_p_x[,2],2))/mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
#
if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
{#
	label="non-determined"#
}else#
{#
	tl=length(Pinf[,1])#
	if(tl<2)#
	{#
		label="non-determined"#
	}else#
	{#
		if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
		{#
			label="CA125 decrease caused by surgery"#
		}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
		{#
			label="sensitive"#
		}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
		{#
			label="resistant"#
		}else#
		{#
			label="non-determined"#
		}#
	}#
#
}#
pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
if(dim(solid_p)[1]>0){#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}else{#
	p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
}#
#
if(length(s_d)>1)#
{#
	s_d=s_d[2:length(s_d)]#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
}else#
{#
	p + ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = "top",legend.direction="vertical")+ xlim(0, Day_limit)+ylim(0,CA125_limit)#
#
}#
#
#+ annotate("text", x = (xstart+20), y = y_l, label = Therapy_s)#
#+theme(legend.key.width=unit(0.3,"cm"),legend.key.height=unit(0.3,"cm"),legend.position = c(0.2,0.01))#
#+theme(legend.position = "top")#
dev.off()#
#}#
print(pname)
source('Bluejay_v0.2.R')
Bluejay.classify('../../../OCI 183.pd')
Bluejay.classify('../../../OCI 1021.pd')
label
source('Bluejay_v0.2.R')
Bluejay.classify('../../../OCI 183.pd')
source('Bluejay_v0.2.R')
Bluejay.classify('../../../OCI 183.pd')
inputfile='../../../OCI 1021.pd'
Day_limit=200,CA125_limit=500,CA125_bound=35
Day_limit=200;CA125_limit=500;CA125_bound=35
fname=strsplit(inputfile, split='.', fixed=TRUE)#
    pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
    Pinf =read.csv(inputfile,head=TRUE)
#surgery date#
    s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
    s_l = length(s_d)#
    Pinf=Pinf[which(Pinf[,1]<(s_d[s_l]+ Day_limit)),]#
    n_nullind=which(Pinf$drug!= "NULL")#
    nnl=length(n_nullind)#
    last_day=Pinf$days[n_nullind[nnl]]#
    last_d=Pinf$drug[n_nullind[nnl]] #
    pd = dim(Pinf)#
    #get therapies name and working time range#
    Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
    Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
    Therapy =Therapy[which(Therapy!="continue")]#
    l=length(Therapy)#
    din=list()
for (i in 1:l)#
    {#
        temp=which(Pinf$drug== Therapy[i])#
        din=cbind(din,t(Pinf$days[temp]))#
    }#
    din=as.numeric(din)#
    din=sort(unique(din))#
    if(din[l]!=last_day)#
    {#
        din=c(din,last_day)#
        l=l+1#
    }#
    if(din[l]==last_day && last_d!="continue")#
    {#
        din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
        l=l+1#
    }#
    nd=Pinf$days[which(Pinf$drug== "NULL")]#
    ndl=length(nd)#
    k=1#
    xstart=list()#
    xend=list()#
    kflag=FALSE#
    for (j in 1:(l-1))#
    {#
        while(din[j]>nd[k] && !kflag)#
        {#
            k=k+1#
            if(k>ndl)#
            {#
                k=ndl#
                kflag=TRUE#
                break#
            }#
        }#
        if(din[j]<nd[k] && !kflag && j<(l-1))#
        {#
            xstart=c(xstart,din[j])#
            if(din[j+1]<nd[k])#
            {#
                xend=c(xend,din[j+1]-1)#
            }#
            else#
            {#
                xend=c(xend,nd[k])#
                k=k+1#
            }#
        }#
        else if(kflag && din[j]>nd[k] && j<(l-1))#
        {#
            xstart=c(xstart,din[j])#
            xend=c(xend,din[j+1]-1)#
        }#
        else if(j==(l-1))#
        {#
            xstart=c(xstart,din[j])#
        }#
        else#
        {#
            xstart=c(xstart,din[j])#
            k=k+1#
        }#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
        }#
    }#
    xend=c(xend,din[j+1])#
    xstart=as.numeric(xstart)-(s_d[1]+21)#
    xend=as.numeric(xend)-(s_d[1]+21)#
    xstart[which(xstart<0)]=0#
    xend[which(xend<0)]=0#
    rects <- data.frame(xstart, xend, Therapy)
#remove NA and plot CA125 profile#
    Pinf=Pinf[!is.na(Pinf$ca125),]#
    y_l=max(Pinf[,2]+300)#
    l_t=length(Therapy)#
    Therapy_s= Therapy#
    Therapy_carb_taxol=NA#
    tct=1#
    for(t in 1:l_t)#
    {#
        Therapy_s[t]=substr(Therapy[t],1,2)#
        if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
        {#
            Therapy_carb_taxol[tct]=t#
            tct=tct+1#
        }#
    }#
    Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
    Pinf=Pinf[which(Pinf[,1]>0),]#
    solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
    solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
    Pinf[which(Pinf[,2]>500),2]= CA125_limit#
    s_n=length(solid_p_x[,2])#
    #average_drop_rate=Bluejay.mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
    adr=mean(diff(Bluejay.mav(solid_p_x[,2],2))/Bluejay.mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)
#classify#
 	label=NULL#
	if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
	{#
		label="non-determined"#
	}else#
	{#
		tl=length(Pinf[,1])#
		if(tl<2)#
		{#
			label="non-determined"#
		}else#
		{#
			if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
			{#
				label="CA125 decrease caused by surgery"#
			}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
			{#
				label="sensitive"#
			}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
			{#
				label="resistant"#
			}else#
			{#
				label="non-determined"#
			}#
		}#
	}
Bluejay.plot(inputfile)
inputfile
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)
inputfile='../../../OCI 183.pd'
#read input file#
    fname=strsplit(inputfile, split='.', fixed=TRUE)#
    pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
    Pinf =read.csv(inputfile,head=TRUE)#
    #surgery date#
    s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
    s_l = length(s_d)#
    Pinf=Pinf[which(Pinf[,1]<(s_d[s_l]+ Day_limit)),]#
    n_nullind=which(Pinf$drug!= "NULL")#
    nnl=length(n_nullind)#
    last_day=Pinf$days[n_nullind[nnl]]#
    last_d=Pinf$drug[n_nullind[nnl]] #
    pd = dim(Pinf)#
    #get therapies name and working time range#
    Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
    Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
    Therapy =Therapy[which(Therapy!="continue")]#
    l=length(Therapy)#
    din=list()#
    for (i in 1:l)#
    {#
        temp=which(Pinf$drug== Therapy[i])#
        din=cbind(din,t(Pinf$days[temp]))#
    }#
    din=as.numeric(din)#
    din=sort(unique(din))#
    if(din[l]!=last_day)#
    {#
        din=c(din,last_day)#
        l=l+1#
    }#
    if(din[l]==last_day && last_d!="continue")#
    {#
        din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
        l=l+1#
    }#
    nd=Pinf$days[which(Pinf$drug== "NULL")]#
    ndl=length(nd)#
    k=1#
    xstart=list()#
    xend=list()#
    kflag=FALSE#
    for (j in 1:(l-1))#
    {#
        while(din[j]>nd[k] && !kflag)#
        {#
            k=k+1#
            if(k>ndl)#
            {#
                k=ndl#
                kflag=TRUE#
                break#
            }#
        }#
        if(din[j]<nd[k] && !kflag && j<(l-1))#
        {#
            xstart=c(xstart,din[j])#
            if(din[j+1]<nd[k])#
            {#
                xend=c(xend,din[j+1]-1)#
            }#
            else#
            {#
                xend=c(xend,nd[k])#
                k=k+1#
            }#
        }#
        else if(kflag && din[j]>nd[k] && j<(l-1))#
        {#
            xstart=c(xstart,din[j])#
            xend=c(xend,din[j+1]-1)#
        }#
        else if(j==(l-1))#
        {#
            xstart=c(xstart,din[j])#
        }#
        else#
        {#
            xstart=c(xstart,din[j])#
            k=k+1#
        }#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
        }#
    }#
    xend=c(xend,din[j+1])#
    xstart=as.numeric(xstart)-(s_d[1]+21)#
    xend=as.numeric(xend)-(s_d[1]+21)#
    xstart[which(xstart<0)]=0#
    xend[which(xend<0)]=0#
    rects <- data.frame(xstart, xend, Therapy)
#remove NA and plot CA125 profile#
    Pinf=Pinf[!is.na(Pinf$ca125),]#
    y_l=max(Pinf[,2]+300)#
    l_t=length(Therapy)#
    Therapy_s= Therapy#
    Therapy_carb_taxol=NA#
    tct=1#
    for(t in 1:l_t)#
    {#
        Therapy_s[t]=substr(Therapy[t],1,2)#
        if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
        {#
            Therapy_carb_taxol[tct]=t#
            tct=tct+1#
        }#
    }#
    Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
    Pinf=Pinf[which(Pinf[,1]>0),]#
    solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
    solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
    Pinf[which(Pinf[,2]>500),2]= CA125_limit#
    s_n=length(solid_p_x[,2])#
    #average_drop_rate=Bluejay.mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
    adr=mean(diff(Bluejay.mav(solid_p_x[,2],2))/Bluejay.mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
 	#classify#
 	label=NULL#
	if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
	{#
		label="non-determined"#
	}else#
	{#
		tl=length(Pinf[,1])#
		if(tl<2)#
		{#
			label="non-determined"#
		}else#
		{#
			if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
			{#
				label="CA125 decrease caused by surgery"#
			}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
			{#
				label="sensitive"#
			}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
			{#
				label="resistant"#
			}else#
			{#
				label="non-determined"#
			}#
		}#
	}
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)
inputfile='../../../OCI 183.pd'
Day_limit=200;CA125_limit=500;CA125_bound=35
fname=strsplit(inputfile, split='.', fixed=TRUE)#
    pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
    Pinf =read.csv(inputfile,head=TRUE)#
    #surgery date#
    s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
    s_l = length(s_d)#
    Pinf=Pinf[which(Pinf[,1]<(s_d[s_l]+ Day_limit)),]#
    n_nullind=which(Pinf$drug!= "NULL")#
    nnl=length(n_nullind)#
    last_day=Pinf$days[n_nullind[nnl]]#
    last_d=Pinf$drug[n_nullind[nnl]] #
    pd = dim(Pinf)#
    #get therapies name and working time range#
    Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
    Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
    Therapy =Therapy[which(Therapy!="continue")]#
    l=length(Therapy)#
    din=list()#
    for (i in 1:l)#
    {#
        temp=which(Pinf$drug== Therapy[i])#
        din=cbind(din,t(Pinf$days[temp]))#
    }
din=as.numeric(din)#
    din=sort(unique(din))#
    if(din[l]!=last_day)#
    {#
        din=c(din,last_day)#
        l=l+1#
    }#
    if(din[l]==last_day && last_d!="continue")#
    {#
        din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
        l=l+1#
    }#
    nd=Pinf$days[which(Pinf$drug== "NULL")]#
    ndl=length(nd)#
    k=1#
    xstart=list()#
    xend=list()#
    kflag=FALSE#
    for (j in 1:(l-1))#
    {#
        while(din[j]>nd[k] && !kflag)#
        {#
            k=k+1#
            if(k>ndl)#
            {#
                k=ndl#
                kflag=TRUE#
                break#
            }#
        }#
        if(din[j]<nd[k] && !kflag && j<(l-1))#
        {#
            xstart=c(xstart,din[j])#
            if(din[j+1]<nd[k])#
            {#
                xend=c(xend,din[j+1]-1)#
            }#
            else#
            {#
                xend=c(xend,nd[k])#
                k=k+1#
            }#
        }#
        else if(kflag && din[j]>nd[k] && j<(l-1))#
        {#
            xstart=c(xstart,din[j])#
            xend=c(xend,din[j+1]-1)#
        }#
        else if(j==(l-1))#
        {#
            xstart=c(xstart,din[j])#
        }#
        else#
        {#
            xstart=c(xstart,din[j])#
            k=k+1#
        }#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
        }#
    }#
    xend=c(xend,din[j+1])#
    xstart=as.numeric(xstart)-(s_d[1]+21)#
    xend=as.numeric(xend)-(s_d[1]+21)#
    xstart[which(xstart<0)]=0#
    xend[which(xend<0)]=0#
    rects <- data.frame(xstart, xend, Therapy)
#remove NA and plot CA125 profile#
    Pinf=Pinf[!is.na(Pinf$ca125),]#
    y_l=max(Pinf[,2]+300)#
    l_t=length(Therapy)#
    Therapy_s= Therapy#
    Therapy_carb_taxol=NA#
    tct=1#
    for(t in 1:l_t)#
    {#
        Therapy_s[t]=substr(Therapy[t],1,2)#
        if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
        {#
            Therapy_carb_taxol[tct]=t#
            tct=tct+1#
        }#
    }#
    Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
    Pinf=Pinf[which(Pinf[,1]>0),]#
    solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
    solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
    Pinf[which(Pinf[,2]>500),2]= CA125_limit#
    s_n=length(solid_p_x[,2])#
    #average_drop_rate=Bluejay.mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
    adr=mean(diff(Bluejay.mav(solid_p_x[,2],2))/Bluejay.mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
 	#classify#
 	label=NULL#
	if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
	{#
		label="non-determined"#
	}else#
	{#
		tl=length(Pinf[,1])#
		if(tl<2)#
		{#
			label="non-determined"#
		}else#
		{#
			if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
			{#
				label="CA125 decrease caused by surgery"#
			}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
			{#
				label="sensitive"#
			}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
			{#
				label="resistant"#
			}else#
			{#
				label="non-determined"#
			}#
		}#
	}
Pinf
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)
inputfile='../../../OCI 183.pd'
Day_limit=200;CA125_limit=500;CA125_bound=35
#read input file#
    fname=strsplit(inputfile, split='.', fixed=TRUE)#
    pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
    Pinf =read.csv(inputfile,head=TRUE)#
    #surgery date#
    s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
    s_l = length(s_d)#
    Pinf=Pinf[which(Pinf[,1]<(s_d[s_l]+ Day_limit)),]#
    n_nullind=which(Pinf$drug!= "NULL")#
    nnl=length(n_nullind)#
    last_day=Pinf$days[n_nullind[nnl]]#
    last_d=Pinf$drug[n_nullind[nnl]] #
    pd = dim(Pinf)#
    #get therapies name and working time range#
    Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
    Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
    Therapy =Therapy[which(Therapy!="continue")]#
    l=length(Therapy)#
    din=list()#
    for (i in 1:l)#
    {#
        temp=which(Pinf$drug== Therapy[i])#
        din=cbind(din,t(Pinf$days[temp]))#
    }#
    din=as.numeric(din)#
    din=sort(unique(din))#
    if(din[l]!=last_day)#
    {#
        din=c(din,last_day)#
        l=l+1#
    }#
    if(din[l]==last_day && last_d!="continue")#
    {#
        din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
        l=l+1#
    }#
    nd=Pinf$days[which(Pinf$drug== "NULL")]#
    ndl=length(nd)#
    k=1#
    xstart=list()#
    xend=list()#
    kflag=FALSE#
    for (j in 1:(l-1))#
    {#
        while(din[j]>nd[k] && !kflag)#
        {#
            k=k+1#
            if(k>ndl)#
            {#
                k=ndl#
                kflag=TRUE#
                break#
            }#
        }#
        if(din[j]<nd[k] && !kflag && j<(l-1))#
        {#
            xstart=c(xstart,din[j])#
            if(din[j+1]<nd[k])#
            {#
                xend=c(xend,din[j+1]-1)#
            }#
            else#
            {#
                xend=c(xend,nd[k])#
                k=k+1#
            }#
        }#
        else if(kflag && din[j]>nd[k] && j<(l-1))#
        {#
            xstart=c(xstart,din[j])#
            xend=c(xend,din[j+1]-1)#
        }#
        else if(j==(l-1))#
        {#
            xstart=c(xstart,din[j])#
        }#
        else#
        {#
            xstart=c(xstart,din[j])#
            k=k+1#
        }#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
        }#
    }#
    xend=c(xend,din[j+1])#
    xstart=as.numeric(xstart)-(s_d[1]+21)#
    xend=as.numeric(xend)-(s_d[1]+21)#
    xstart[which(xstart<0)]=0#
    xend[which(xend<0)]=0#
    rects <- data.frame(xstart, xend, Therapy)#
    #remove NA and plot CA125 profile#
    Pinf=Pinf[!is.na(Pinf$ca125),]#
    y_l=max(Pinf[,2]+300)#
    l_t=length(Therapy)#
    Therapy_s= Therapy#
    Therapy_carb_taxol=NA#
    tct=1#
    for(t in 1:l_t)#
    {#
        Therapy_s[t]=substr(Therapy[t],1,2)#
        if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
        {#
            Therapy_carb_taxol[tct]=t#
            tct=tct+1#
        }#
    }#
    Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
    Pinf=Pinf[which(Pinf[,1]>0),]#
    #solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
    #solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
    #Pinf[which(Pinf[,2]>500),2]= CA125_limit#
    #s_n=length(solid_p_x[,2])#
    #average_drop_rate=Bluejay.mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
    #adr=mean(diff(Bluejay.mav(solid_p_x[,2],2))/Bluejay.mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
 	#classify#
 	label=NULL#
	if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
	{#
		label="non-determined"#
	}else#
	{#
		tl=length(Pinf[,1])#
		if(tl<2)#
		{#
			label="non-determined"#
		}else#
		{#
			if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
			{#
				label="CA125 decrease caused by surgery"#
			}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
			{#
				label="sensitive"#
			}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
			{#
				label="resistant"#
			}else#
			{#
				label="non-determined"#
			}#
		}#
	}
Bluejay.plot(inputfile)
Bluejay.plot <- function(inputfile)#
{#
    fname=strsplit(inputfile, split='.', fixed=TRUE)#
    pname=strsplit(fname[[1]][1], split=' ', fixed=TRUE)#
    Pinf =read.csv(inputfile,head=TRUE)#
#
	Pinf =read.csv(inputfile,head=TRUE)#
	pd = dim(Pinf)#
#
	n_nullind=which(Pinf$drug!= "NULL")#
	nnl=length(n_nullind)#
	last_day=Pinf$days[n_nullind[nnl]]#
	last_d=Pinf$drug[n_nullind[nnl]]#
	s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
#
	#rects <- data.frame(xstart = c(1,10,1324), xend = c(9,1323,1399), col = as.character(unique(Pinf$drug)))#
	Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
	Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
	Therapy =Therapy[which(Therapy!="continue")]#
#
	l=length(Therapy)#
	din=list()#
	for (i in 1:l)#
	{#
	    temp=which(Pinf$drug== Therapy[i])#
	    din=cbind(din,t(Pinf$days[temp]))#
	}#
#
	din=as.numeric(din)#
#
	din=sort(unique(din))#
#
	if(din[l]!=last_day)#
	{#
 	   din=c(din,last_day)#
 	   l=l+1#
	}#
#
	if(din[l]==last_day && last_d!="continue")#
	{#
 	   din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
	    l=l+1#
	}#
#
	nd=Pinf$days[which(Pinf$drug== "NULL")]#
#
	ndl=length(nd)#
#
	k=1#
	xstart=list()#
	xend=list()#
	kflag=FALSE#
	for (j in 1:(l-1))#
	{#
 	   while(din[j]>nd[k] && !kflag)#
 	   {#
	        k=k+1#
	        if(k>ndl)#
	        {#
	            k=ndl#
	            kflag=TRUE#
	            break#
	        }#
	    }#
 	   if(din[j]<nd[k] && !kflag && j<(l-1))#
 	   {#
			xstart=c(xstart,din[j])#
			if(din[j+1]<nd[k])#
			{#
				xend=c(xend,din[j+1]-1)#
			}#
			else#
			{#
	            xend=c(xend,nd[k])#
	            k=k+1#
	        }#
	    }#
	    else if(kflag && din[j]>nd[k] && j<(l-1))#
	    {#
	        xstart=c(xstart,din[j])#
	        xend=c(xend,din[j+1]-1)#
	   }#
	   else if(j==(l-1))#
	    {#
	        xstart=c(xstart,din[j])#
	    }#
	    else#
	    {#
	        xstart=c(xstart,din[j])#
	        k=k+1#
	    }#
	    if(k>ndl)#
	    {#
	        k=ndl#
	        kflag=TRUE#
	    }#
	}#
	xend=c(xend,din[j+1])#
#
	xstart=as.numeric(xstart)#
	xend=as.numeric(xend)#
#
	rects <- data.frame(xstart, xend, Therapy)#
#
	Pinf=Pinf[!is.na(Pinf$ca125),]#
	y_l=max(Pinf[,2]+300)#
	l_t=length(Therapy)#
	Therapy_s= Therapy#
#
	for(t in 1:l_t)#
	{#
		Therapy_s[t]=substr(Therapy[t],1,2)#
	}#
	#solid_in=which(Pinf[,2]<=500)#
	Pinf[which(Pinf[,2]>500),2]=500#
	solid_p=Pinf[which(Pinf[,2]<500),]#
#
	pdf(paste("patient_", fname[[1]][1],"_ca125_plot.pdf", sep = ""))#
#
	if(dim(solid_p)[1]>0){#
		p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
	geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+geom_point(data= solid_p, 	aes(x=days, y=ca125, group=1),na.rm = TRUE,size = 3)+theme_bw() + theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = 		element_blank())#
	}else{#
		p <- ggplot() +geom_rect(data = rects, aes(xmin = xstart, xmax = xend, ymin = -Inf, ymax = Inf, fill = Therapy), alpha = 0.4)+#
	geom_line(data= Pinf, aes(x=days, y=ca125, group=1)) + geom_point(data= Pinf, aes(x=days, y=ca125, group=1,shape = factor(1)),na.rm = TRUE,colour="grey50", size = 3)+guides(shape=FALSE)+ scale_shape(solid = FALSE)+theme_bw() + 	theme(axis.line = element_line(colour = "black"),panel.grid.major = element_blank(),panel.grid.minor = element_blank(),panel.border = element_blank(),panel.background = element_blank())#
	}#
#
	p + geom_vline(xintercept = s_d,colour="red", linetype = "dotted",size = 1)+ ggtitle(paste("Patient ", pname[[1]][2]," CA125", "\n", label, sep = "")) + theme(plot.title = element_text(size=22, face="bold.italic")) +theme(legend.position = 	"top",legend.direction="vertical")+ xlim(0, 1000)+ylim(0,500)#
#
	dev.off()#
#
}
Bluejay.plot(inputfile)
fname
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
source('Bluejay_v0.2.R')#
Bluejay.classify('../../../OCI 183.pd','183')
inputfile=../../../OCI 183.pd
inputfile=''../../../OCI 183.pd'
inputfile='../../../OCI 183.pd'
patient_name='183'
Day_limit=200
CA125_limit=500
CA125_bound=35
Pinf =read.csv(inputfile,head=TRUE)#
    #surgery date#
    s_d = as.numeric(Pinf$s_d[!is.na(Pinf$s_d)])#
    s_l = length(s_d)#
    Pinf=Pinf[which(Pinf[,1]<(s_d[s_l]+ Day_limit)),]#
    n_nullind=which(Pinf$drug!= "NULL")#
    nnl=length(n_nullind)#
    last_day=Pinf$days[n_nullind[nnl]]#
    last_d=Pinf$drug[n_nullind[nnl]] #
    pd = dim(Pinf)#
    #get therapies name and working time range#
    Therapy_ds = as.character(Pinf$drug[!is.na(Pinf$drug)])#
    Therapy =Therapy_ds[which(Therapy_ds!="NULL")]#
    Therapy =Therapy[which(Therapy!="continue")]#
    l=length(Therapy)#
    din=list()#
    for (i in 1:l)#
    {#
        temp=which(Pinf$drug== Therapy[i])#
        din=cbind(din,t(Pinf$days[temp]))#
    }#
    din=as.numeric(din)#
    din=sort(unique(din))#
    if(din[l]!=last_day)#
    {#
        din=c(din,last_day)#
        l=l+1#
    }#
    if(din[l]==last_day && last_d!="continue")#
    {#
        din=c(din,Pinf$days[(n_nullind[nnl]+1)])#
        l=l+1#
    }#
    nd=Pinf$days[which(Pinf$drug== "NULL")]#
    ndl=length(nd)#
    k=1#
    xstart=list()#
    xend=list()#
    kflag=FALSE#
    for (j in 1:(l-1))#
    {#
        while(din[j]>nd[k] && !kflag)#
        {#
            k=k+1#
            if(k>ndl)#
            {#
                k=ndl#
                kflag=TRUE#
                break#
            }#
        }#
        if(din[j]<nd[k] && !kflag && j<(l-1))#
        {#
            xstart=c(xstart,din[j])#
            if(din[j+1]<nd[k])#
            {#
                xend=c(xend,din[j+1]-1)#
            }#
            else#
            {#
                xend=c(xend,nd[k])#
                k=k+1#
            }#
        }#
        else if(kflag && din[j]>nd[k] && j<(l-1))#
        {#
            xstart=c(xstart,din[j])#
            xend=c(xend,din[j+1]-1)#
        }#
        else if(j==(l-1))#
        {#
            xstart=c(xstart,din[j])#
        }#
        else#
        {#
            xstart=c(xstart,din[j])#
            k=k+1#
        }#
        if(k>ndl)#
        {#
            k=ndl#
            kflag=TRUE#
        }#
    }#
    xend=c(xend,din[j+1])#
    xstart=as.numeric(xstart)-(s_d[1]+21)#
    xend=as.numeric(xend)-(s_d[1]+21)#
    xstart[which(xstart<0)]=0#
    xend[which(xend<0)]=0#
    rects <- data.frame(xstart, xend, Therapy)#
    #remove NA and plot CA125 profile#
    Pinf=Pinf[!is.na(Pinf$ca125),]#
    #y_l=max(Pinf[,2]+300)#
    l_t=length(Therapy)#
    Therapy_s= Therapy#
    Therapy_carb_taxol=NA#
    tct=1#
    for(t in 1:l_t)#
    {#
        Therapy_s[t]=substr(Therapy[t],1,2)#
        if(grepl("Carboplatin", Therapy[t]) || grepl("Taxol", Therapy[t]))#
        {#
            Therapy_carb_taxol[tct]=t#
            tct=tct+1#
        }#
    }#
    Pinf[,1]=Pinf[,1]-(s_d[1]+21)#
    Pinf=Pinf[which(Pinf[,1]>0),]#
    #solid_p_x=Pinf[which(Pinf[,1]<Day_limit),]#
    #solid_p=Pinf[which(Pinf[,2]<= CA125_limit),]#
    #Pinf[which(Pinf[,2]>500),2]= CA125_limit#
    #s_n=length(solid_p_x[,2])#
    #average_drop_rate=Bluejay.mav(Pinf[,2],2)#movingAverage(Pinf[,2], n=s_n, centered=FALSE)#
    #adr=mean(diff(Bluejay.mav(solid_p_x[,2],2))/Bluejay.mav(solid_p_x[,2],2)[c(1:(s_n-1))],na.rm=TRUE)#
 	#classify#
 	label=NULL#
	if(length(s_d)>1 & (s_d[2]-s_d[1])<Day_limit)#
	{#
		label="non-determined"#
	}else#
	{#
		tl=length(Pinf[,1])#
		if(tl<2)#
		{#
			label="non-determined"#
		}else#
		{#
			if(Pinf[1,2]<= CA125_bound & length(which(solid_p_x[,2]> (CA125_bound+5)))<1)#
			{#
				label="CA125 decrease caused by surgery"#
			}else if(Pinf[1,2]>= CA125_bound & (adr < (-0.3) || length(which(solid_p_x[,2] < CA125_bound))>0) )#
			{#
				label="sensitive"#
			}else if(Pinf[1,2]>= CA125_bound & adr > (-0.3) )#
			{#
				label="resistant"#
			}else#
			{#
				label="non-determined"#
			}#
		}#
	}#
    p=Bluejay.plot(inputfile, patient_name,label)
p
pdf(paste("patient_", patient_name, "_ca125_plot.pdf", sep = ""))#
    p#
    dev.off()
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
source('Bluejay_v0.2.R')#
Bluejay.classify('../../../OCI 183.pd','183')
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
source('Bluejay_v0.2.R')#
Bluejay.classify('../../../OCI 183.pd','183')
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
source('Bluejay_v0.2.R')#
Bluejay.classify('../../../OCI 183.pd','183')
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
source('Bluejay_v0.2.R')#
Bluejay.classify('../../../OCI 183.pd','183')
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
source('Bluejay_v0.2.R')#
Bluejay.classify('../../../OCI 183.pd','183')#
Bluejay.classify('../../../OCI 528p.pd','528p')#
Bluejay.classify('../../../OCI 992.pd','992')#
Bluejay.classify('../../../OCI 545R.pd','545R')#
Bluejay.classify('../../../OCI 1021.pd','1021')#
Bluejay.classify('../../../OCI 813.pd','813')#
Bluejay.classify('../../../OCI 588.pd','588')#
Bluejay.classify('../../../OCI 242.pd','242')#
Bluejay.classify('../../../OCI 1145.pd','1145')#
Bluejay.classify('../../../OCI 1129.pd','1129')#
Bluejay.classify('../../../OCI 1122-1153.pd','1122')#
Bluejay.classify('../../../OCI 489-559.pd','489')#
Bluejay.classify('../../../OCI 413.pd','413')#
Bluejay.classify('../../../OCI 542.pd','542')#
Bluejay.classify('../../../OCI 272.pd','272')#
Bluejay.classify('../../../OCI 336.pd','336')#
Bluejay.classify('../../../OCI 229.pd','229')#
Bluejay.classify('../../../OCI 317.pd','317')#
Bluejay.classify('../../../OCI 537.pd','537')#
Bluejay.classify('../../../OCI 369.pd','369')
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
source('Bluejay_v0.2.R')#
Bluejay.classify('../../../OCI 183.pd','183')
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
source('Bluejay_v0.2.R')#
Bluejay.classify('../../../OCI 183.pd','183')#
Bluejay.classify('../../../OCI 528p.pd','528p')#
Bluejay.classify('../../../OCI 992.pd','992')#
Bluejay.classify('../../../OCI 545R.pd','545R')#
Bluejay.classify('../../../OCI 1021.pd','1021')#
Bluejay.classify('../../../OCI 813.pd','813')#
Bluejay.classify('../../../OCI 588.pd','588')#
Bluejay.classify('../../../OCI 242.pd','242')#
Bluejay.classify('../../../OCI 1145.pd','1145')#
Bluejay.classify('../../../OCI 1129.pd','1129')#
Bluejay.classify('../../../OCI 1122-1153.pd','1122')#
Bluejay.classify('../../../OCI 489-559.pd','489')#
Bluejay.classify('../../../OCI 413.pd','413')#
Bluejay.classify('../../../OCI 542.pd','542')#
Bluejay.classify('../../../OCI 272.pd','272')#
Bluejay.classify('../../../OCI 336.pd','336')#
Bluejay.classify('../../../OCI 229.pd','229')#
Bluejay.classify('../../../OCI 317.pd','317')#
Bluejay.classify('../../../OCI 537.pd','537')#
Bluejay.classify('../../../OCI 369.pd','369')
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
source('Bluejay_v0.2.R')#
Bluejay.classify('../../../OCI 183.pd','183')
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
source('Bluejay_v0.2.R')#
Bluejay.classify('../../../OCI 183.pd','183')
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
source('Bluejay_v0.2.R')#
Bluejay.classify('../../../OCI 183.pd','183')
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
source('Bluejay_v0.2.R')#
Bluejay.classify('../../../OCI 183.pd','183')
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
source('Bluejay_v0.2.R')#
Bluejay.classify('../../../OCI 183.pd','183')
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
source('Bluejay_v0.2.R')#
Bluejay.classify('../../../OCI 183.pd','183')#
Bluejay.classify('../../../OCI 528p.pd','528p')#
Bluejay.classify('../../../OCI 992.pd','992')#
Bluejay.classify('../../../OCI 545R.pd','545R')#
Bluejay.classify('../../../OCI 1021.pd','1021')#
Bluejay.classify('../../../OCI 813.pd','813')#
Bluejay.classify('../../../OCI 588.pd','588')#
Bluejay.classify('../../../OCI 242.pd','242')#
Bluejay.classify('../../../OCI 1145.pd','1145')#
Bluejay.classify('../../../OCI 1129.pd','1129')#
Bluejay.classify('../../../OCI 1122-1153.pd','1122')#
Bluejay.classify('../../../OCI 489-559.pd','489')#
Bluejay.classify('../../../OCI 413.pd','413')#
Bluejay.classify('../../../OCI 542.pd','542')#
Bluejay.classify('../../../OCI 272.pd','272')#
Bluejay.classify('../../../OCI 336.pd','336')#
Bluejay.classify('../../../OCI 229.pd','229')#
Bluejay.classify('../../../OCI 317.pd','317')#
Bluejay.classify('../../../OCI 537.pd','537')#
Bluejay.classify('../../../OCI 369.pd','369')
rm(list = setdiff(ls(), lsf.str()))#
library(ggplot2)#
library(grid)#
source('Bluejay_v0.2.R')#
Bluejay.classify('../../../OCI 183.pd','183')#
Bluejay.classify('../../../OCI 528p.pd','528p')#
Bluejay.classify('../../../OCI 992.pd','992')#
Bluejay.classify('../../../OCI 545R.pd','545R')#
Bluejay.classify('../../../OCI 1021.pd','1021')#
Bluejay.classify('../../../OCI 813.pd','813')#
Bluejay.classify('../../../OCI 588.pd','588')#
Bluejay.classify('../../../OCI 242.pd','242')#
Bluejay.classify('../../../OCI 1145.pd','1145')#
Bluejay.classify('../../../OCI 1129.pd','1129')#
Bluejay.classify('../../../OCI 1122-1153.pd','1122')#
Bluejay.classify('../../../OCI 489-559.pd','489')#
Bluejay.classify('../../../OCI 413.pd','413')#
Bluejay.classify('../../../OCI 542.pd','542')#
Bluejay.classify('../../../OCI 272.pd','272')#
Bluejay.classify('../../../OCI 336.pd','336')#
Bluejay.classify('../../../OCI 229.pd','229')#
Bluejay.classify('../../../OCI 317.pd','317')#
Bluejay.classify('../../../OCI 537.pd','537')#
Bluejay.classify('../../../OCI 369.pd','369')
